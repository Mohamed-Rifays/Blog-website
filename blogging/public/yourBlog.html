<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Blogs</title>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Arial, Helvetica, sans-serif;
    }

    body {
      min-height: 100vh;
      background: #f5f5f7;
    }

    /* ===== Layout ===== */
    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* ===== Sidebar ===== */
    .sidebar {
      width: 240px;
      background: #111827;
      color: white;
      padding: 30px 20px;
    }

    .sidebar h3 {
      margin-bottom: 30px;
    }

    .sidebar button {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: none;
      border-radius: 6px;
      background: #1f2933;
      color: white;
      cursor: pointer;
      text-align: left;
    }

    .sidebar button:hover {
      background: #2563eb;
    }

    /* ===== Main Content ===== */
    .main {
      flex: 1;
      padding: 30px 20px;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 25px;
    }

    .blog-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .blog-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .posted-on {
      font-size: 0.9rem;
      color: #888;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
    }

    .delete-btn {
      background: #ff4d4d;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .delete-btn:hover {
      background: #e60000;
    }

    .edit-btn {
      background: #4a90e2;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .edit-btn:hover {
      background: #357ab8;
    }

    .blog-card h2 {
      margin: 5px 0;
      color: #444;
    }

    .blog-card h3 {
      margin: 0 0 10px 0;
      color: #666;
      font-weight: normal;
    }

    .blog-card p {
      margin: 0;
      color: #555;
      line-height: 1.6rem;
    }

    .no-blogs {
      text-align: center;
      font-size: 1.2rem;
      margin-top: 40px;
      color: #777;
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        display: flex;
        gap: 10px;
        overflow-x: auto;
      }

      .sidebar button {
        flex: 1;
        text-align: center;
      }
    }
  </style>
</head>

<body>

  <div class="layout">

    <!-- Sidebar -->
    <div class="sidebar">
      <h3>Options</h3>
      <button onclick="goHome()">Home</button>
      <button onclick="goDashboard()">Dashboard</button>
      <button onclick="goEditProfile()">Edit Profile</button>
    </div>

    <!-- Main -->
    <div class="main">
      <div class="container" id="my-blogs"></div>
    </div>

  </div>

  <script>
    async function loadMyBlogs() {
      const container = document.getElementById('my-blogs');
      const token = localStorage.getItem('token');

      if (!token) {
        container.innerHTML = `
          <h1>My Blogs</h1>
          <p class="no-blogs">You must be logged in to view your blogs.</p>
        `;
        return;
      }

      try {
        const req = await fetch('/blogs/me', {
          headers: { Authorization: `Bearer ${token}` }
        });

        const blogs = await req.json();

        if (!blogs.length) {
          container.innerHTML = `
            <h1>My Blogs</h1>
            <p class="no-blogs">You havenâ€™t created any blogs yet.</p>
          `;
          return;
        }

        container.innerHTML = `
          <h1>My Blogs</h1>
          ${blogs.map(blog => {
            const date = new Date(blog.createdAt).toLocaleString();

            return `
              <div class="blog-card">
                <div class="blog-header">
                  <div class="posted-on">Posted on: ${date}</div>
                  <div class="action-buttons">
                    <button class="edit-btn"
                      onclick="editBlog(
                        '${blog._id}',
                        '${escapeHtml(blog.title)}',
                        '${escapeHtml(blog.subtitle)}',
                        '${escapeHtml(blog.content)}'
                      )">Edit</button>

                    <button class="delete-btn"
                      onclick="deleteBlog('${blog._id}')">Delete</button>
                  </div>
                </div>

                <h2>${blog.title}</h2>
                <h3>${blog.subtitle}</h3>
                <p>${blog.content}</p>
              </div>
            `;
          }).join('')}
        `;

      } catch {
        container.innerHTML = `
          <h1>My Blogs</h1>
          <p class="no-blogs">Failed to load blogs.</p>
        `;
      }
    }

    async function deleteBlog(id) {
      const token = localStorage.getItem('token');
      if (!confirm('Delete this blog?')) return;

      const res = await fetch(`/blogs/${id}`, {
        method: 'DELETE',
        headers: { Authorization: `Bearer ${token}` }
      });

      if (res.ok) loadMyBlogs();
      else alert('Delete failed');
    }

    async function editBlog(id, t, s, c) {
      const title = prompt('Edit title', t);
      const subtitle = prompt('Edit subtitle', s);
      const content = prompt('Edit content', c);
      if (!title || !subtitle || !content) return;

      const token = localStorage.getItem('token');

      const res = await fetch(`/blogs/${id}`, {
        method: 'PATCH',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ title, subtitle, content })
      });

      if (res.ok) loadMyBlogs();
      else alert('Update failed');
    }

    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    /* Sidebar navigation */
    const goDashboard = () => location.href = 'dashboard.html';
    const goEditProfile = () => location.href = 'edit-profile.html';
    const goHome = () => location.href = 'index.html';
   

    const deleteAccount = async () => {
      if (!confirm('Are you sure?')) return;
      const token = localStorage.getItem('token');
      await fetch('/users/me', {
        method: 'DELETE',
        headers: { Authorization: `Bearer ${token}` }
      });
      localStorage.removeItem('token');
      location.href = 'signup.html';
    };

    loadMyBlogs();
  </script>

</body>
</html>
